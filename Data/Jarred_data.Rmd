---
title: "Watauga"
author: "Jarred_Randall"
date: "2024-02-12"
output: html_document
---
```{r clear_environment, cache=TRUE, include=F}

rm(list=ls())

```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

```{r Library}
install.packages("FedData")
install.packages("animation")
library(raster) 
library(rgdal)
library(animation)
library(rasterVis)
library(FedData)
library(tidyverse)
library(tidycensus)
library(sf)
library(dplyr)
library(animation)
library(RColorBrewer) 
library(ggplot2)      
library(colorspace)
library(tidyr)
library(readr)
library(terra)
library(kableExtra)
library(exactextractr)
options(scipen = 999, digits = 2)


color_palette <- c("#e2a334", "#f9bf3e", "#fcd977", "#9ad7d2", "#74c1b9")
```
# Write up

## Problem Statement / Use Case

Watauga County, North Carolina, is currently experiencing a housing shortage that is expected to intensify in the near future. The shortage is exacerbated by vacation rentals and student housing, which has significantly reduced the available residential housing options. The Watauga Housing Solutions Committee is partnering with other community and local government organizations looking to develop affordable and workforce housing in order to mitigate the severe decreases in housing affordability. They are working with a developer to prioritize the most feasible sites to pursue for purchase and development. Because of the extreme physical conditions of the landscape (slope, soils, etc.) there is currently no streamlined system in place to help identify suitable parcels for development. In response to this issue, we have been contracted to develop an application-based data framework that is designed to identify land parcels based on their likelihood to be developed for affordable and workforce housing.  This data framework will be designed to function as an interactive application interface that will allow users to input criteria related to land supply and combine it with development likelihood estimates to rank each parcel in the county in terms of suitability.

## Project Client:

The main project client is the Watauga Housing Council and its Housing Solutions Committee. This organization is tasked with responding to the economic, environmental, and social aspects of the county to provide adequate housing options for all residents. our main points of contacts within the housing council are Dr. Kellie Reed Ashcraft, Facilitator/Organizer, Watauga Housing Council, Dr. Chris Quattro, Assistant Professor, Appalachian State University/Member, Watauga Housing Council , Laura Beach, Member, Watauga Housing Council. 

## Dependent Variable: Septic System Permits 
The key indicator for development (dependent variable) that will be used is the administrative record associated with septic system permits. This permit is exclusively granted when a property satisfies the requirements for both land supply and developer demand at that specific site. Due to the rural nature of the project area, there is relatively low wastewater sewer coverage. subsequently, a septic system is critical for new development, and a site cannot be developed without one. Our approach will involve identifying the site suitability characteristics (e.g., slope, soils) most closely related to the probability of a parcel receiving a septic permit. Using this information, we will forecast the likelihood that a given parcel will receive a new septic permit. 


# Data Wrangling Percent Rent Burdened by Surrounding Counties 
```{r}

county17 <- 
  get_acs(geography = "county", 
          variables = c("B25070_007E",
                        "B25070_008E",
                        "B25070_009E",
                        "B25070_010E",
                        "B25070_011E",
                        "B25003_003E"), 
          year=2017, state="NC", 
          geometry=TRUE, output="wide") %>%
  st_transform('EPSG:4326') %>%
  rename(RentBurden_30_35 = B25070_007E,
         RentBurden_35_39 = B25070_008E,
         RentBurden_40_49 = B25070_009E,
         RentBurden_50_99 = B25070_010E,
         RentBurden_60_more = B25070_011E,
         total_renter_occupied = B25003_003E) %>%
  dplyr::select(-starts_with("B")) %>%
  mutate(rent_burdened_households = RentBurden_30_35 + RentBurden_35_39 + RentBurden_40_49 + RentBurden_50_99 + RentBurden_60_more,
         Percent_rent_burdened = round((rent_burdened_households / total_renter_occupied) * 100, 0),
         NAME = str_replace(NAME, ", North Carolina", "")) %>%
  dplyr::filter(NAME %in% c("Avery County", "Wilkes County", "Ashe County", "Watauga County","Caldwell County")) %>%
  dplyr::select(GEOID, NAME, rent_burdened_households, total_renter_occupied, Percent_rent_burdened)



county22 <- 
  get_acs(geography = "county", 
          variables = c("B25070_007E",
                        "B25070_008E",
                        "B25070_009E",
                        "B25070_010E",
                        "B25070_011E",
                        "B25003_003E"), 
          year=2022, state="NC", 
          geometry=TRUE, output="wide") %>%
  st_transform('EPSG:4326') %>%
  rename(RentBurden_30_35 = B25070_007E,
         RentBurden_35_39 = B25070_008E,
         RentBurden_40_49 = B25070_009E,
         RentBurden_50_99 = B25070_010E,
         RentBurden_60_more = B25070_011E,
         total_renter_occupied = B25003_003E) %>%
  dplyr::select(-starts_with("B")) %>%
  mutate(rent_burdened_households = RentBurden_30_35 + RentBurden_35_39 + RentBurden_40_49 + RentBurden_50_99 + RentBurden_60_more,
         Percent_rent_burdened = round((rent_burdened_households / total_renter_occupied) * 100, 0),
         NAME = str_replace(NAME, ", North Carolina", "")) %>%
  dplyr::filter(NAME %in% c("Avery County", "Wilkes County", "Ashe County", "Watauga County", "Caldwell County")) %>%
  dplyr::select(GEOID, NAME, rent_burdened_households, total_renter_occupied, Percent_rent_burdened)

county17 <- county17 %>% mutate(year = 2017)
county22 <- county22 %>% mutate(year = 2022)

combined_years <- bind_rows(county17, county22)



county22 <- 
  get_acs(geography = "county", 
          variables = c("B25070_007E",
                        "B25070_008E",
                        "B25070_009E",
                        "B25070_010E",
                        "B25070_011E",
                        "B25003_003E"), 
          year=2022, state="NC", 
          geometry=TRUE, output="wide") %>%
  st_transform('EPSG:4326') %>%
  rename(RentBurden_30_35 = B25070_007E,
         RentBurden_35_39 = B25070_008E,
         RentBurden_40_49 = B25070_009E,
         RentBurden_50_99 = B25070_010E,
         RentBurden_60_more = B25070_011E,
         total_renter_occupied = B25003_003E) %>%
  dplyr::select(-starts_with("B"))

```

# Maps
```{r}

ggplot(data = county17) +
  geom_sf(aes(fill = Percent_rent_burdened)) + # Removed color = color_palette here
  scale_fill_gradientn(colors = color_palette) + # Use this to apply your color palette
  geom_sf_text(aes(label = NAME), 
               size = 4, # Adjusted size
               colour = "black", 
               check_overlap = TRUE,
               fontface = "bold") + # Make text bold
  geom_sf_text(aes(label = paste0(Percent_rent_burdened, "%")), 
               size = 3.5, # Adjusted size
               colour = "black", 
               check_overlap = TRUE, 
               nudge_y = -0.05,
               fontface = "bold") + # Make text bold
  labs(title = "Rent Burdened Households by County",
       subtitle = "Year: 2017") +
  theme_void() +
  theme(legend.position = "right")
```


```{r}

ggplot(data = county22) +
  geom_sf(aes(fill = Percent_rent_burdened)) + # Removed color = color_palette here
  scale_fill_gradientn(colors = color_palette) + # Use this to apply your color palette
  geom_sf_text(aes(label = NAME), 
               size = 4, # Adjusted size
               colour = "black", 
               check_overlap = TRUE,
               fontface = "bold") + # Make text bold
  geom_sf_text(aes(label = paste0(Percent_rent_burdened, "%")), 
               size = 3.5, # Adjusted size
               colour = "black", 
               check_overlap = TRUE, 
               nudge_y = -0.05,
               fontface = "bold") + # Make text bold
  labs(title = "Rent Burdened Households by County",
       subtitle = "Year: 2022") +
  theme_void() +
  theme(legend.position = "right")
```

```{r read_data}

boundary <- st_read("C:/Users/fatbo/OneDrive/Documents/GitHub/Musa_801_Watauga/GeoJSON/Boundary.geojson")

fire_districts <- st_read("C:/Users/fatbo/OneDrive/Documents/GitHub/Musa_801_Watauga/GeoJSON/FireDistricts_FeaturesToJSON.geojson")

managed_areas <- st_read("C:/Users/fatbo/OneDrive/Documents/GitHub/Musa_801_Watauga/GeoJSON/managed_areasToJSON.geojson")

natural_areas <- st_read("C:/Users/fatbo/OneDrive/Documents/GitHub/Musa_801_Watauga/GeoJSON/Natural_area_JSON.geojson")

zoned_areas <- st_read("C:/Users/fatbo/OneDrive/Documents/GitHub/Musa_801_Watauga/GeoJSON/zonedareas_FeaturesToJSON.geojson")

municipal_bound <- st_read("C:/Users/fatbo/OneDrive/Documents/GitHub/Musa_801_Watauga/GeoJSON/NCDOT_Municipal_Boundaries.geojson")

county_bound <- st_read("C:/Users/fatbo/OneDrive/Documents/GitHub/Musa_801_Watauga/GeoJSON/NCDOT_County_Boundaries.geojson")

parcels <- st_read("C:/Users/fatbo/OneDrive/Documents/GitHub/Musa_801_Watauga/Data/parcel/parcel.geojson")

# Landcover Vector

legend<-pal_nlcd()

lc_2021 <- raster("C:/Users/fatbo/OneDrive/Documents/GitHub/Musa_801_Watauga/Data/Landuse_Raster/lulc_2021")
lc_2019 <- raster("C:/Users/fatbo/OneDrive/Documents/GitHub/Musa_801_Watauga/Data/Landuse_Raster/lulc_2019")
lc_2016 <- raster("C:/Users/fatbo/OneDrive/Documents/GitHub/Musa_801_Watauga/Data/Landuse_Raster/lulc_2016")
lc_2013 <- raster("C:/Users/fatbo/OneDrive/Documents/GitHub/Musa_801_Watauga/Data/Landuse_Raster/lulc_2013")
lc_2011 <- raster("C:/Users/fatbo/OneDrive/Documents/GitHub/Musa_801_Watauga/Data/Landuse_Raster/lulc_2011")


```

```{r}

ggplot() +
  geom_sf(data = boundary, fill = NA, color = "black") + 
  geom_sf(data = managed_areas, aes(fill = OWNER_TYPE)) + 
  scale_fill_manual(values = color_palette) + 
  labs(title = "Watauga Managed Areas by Owner Type",
       subtitle = "Year: 2022") +
  theme_void() +
  theme(legend.position = "right")
```

```{r}

ggplot() +
  geom_sf(data = boundary, fill = NA, color = "black") + 
  geom_sf(data = natural_areas, aes(fill = C_RATING)) + 
  scale_fill_manual(values = color_palette) + 
  labs(title = "Watauga Natural",
       subtitle = "Year: 2022") +
  theme_void() +
  theme(legend.position = "right")
```

####### Updated Landcover section

### Watauga 2021 Land cover 

The Watauga County 2021 land cover underscores the county's rich natural resources and moderate urban development. The total land cover area is predominantly forested land (74.56%), with 54.16% of the countyâ€™s land cover area being deciduous forest and 19.2% mixed forest, and 1.2% evergreen forest. Developed areas, which is limited to about 13.89% of the total land cover area is made up of 11.23% of developed open space, 1.48% developed low intensity, 0.9% developed medium density, 0.28% developed high intensity. The majority of development is classified as open space, which could encompass parks, golf courses, or agricultural land that adds to the rural character of the county. The incrementally smaller percentages for low, medium, and high-intensity developments indicate concentrated urbanization around cities and transportation corridors, reflecting strategic land use planning that preserves the natural landscape while accommodating residential and commercial needs.

```{r lc_2021, echo=FALSE, message=FALSE, warning=FALSE}
s <- stack(lc_2011, lc_2013, lc_2016,lc_2019, lc_2021 )



vals <-unique(s[[5]])  # Get unique values from lc_2021
df <- legend[legend$ID %in% vals,]  # Filter legend information based on lc_2021 values
rat5 <- ratify(lc_2021)

myKey <- list(
  rectangles = list(col = df$Color),
  text = list(lab = df$Class),
  space = 'right',
  columns = 1,
  size = 2,
  cex = .6
)

levelplot(rat5, att='ID', 
          col.regions=df$Color,
          maxpixels=ncell(rat5), # Try setting maxpixels to the number of cells in the raster
          par.settings = list(
            axis.line = list(col = "transparent"), 
            strip.background = list(col = 'transparent'), 
            strip.border = list(col = 'transparent')
          ), 
          scales = list(col = "transparent"),
          colorkey = FALSE,
          key = myKey,
          main = "Watauga 2021 Land Cover") # Title added here

```

#### Land Cover 10 year changes {.tabset}

From 2011 and 2021 Watauga County witnessed a notable shift in land cover, particularly in terms of development and the reduction of natural landscapes like grasslands and shrublands. The data indicates a 13.89% increase in developed areas, with significant growth in low, medium, and high-intensity developments. Most notably, medium intensity development saw a significant increase of 17.22% in 2021. Concurrently, the county experienced a dramatic 56.5% decrease in Grassland/Herbaceous areas and a 50% reduction in Shrub/Scrub land. These changes could be attributed to several factors, including the conversion of open fields and grasslands into developed land or possibly into agricultural use. The majority of the land cover remains natural or semi-natural, with developed open spaces also experiencing a small rise. The data suggests a careful balance between development and the maintenance of natural land covers over the past decade.

##### 2011-2021 {.unnumbered}

```{r lc_time_series, echo=FALSE, message=FALSE, warning=FALSE}

years.list <- list("2011", "2013", "2016", "2019", "2021")


suppressMessages({saveGIF({
  for(i in 1:nlayers(s)){
    rat <- ratify(s[[i]])
    plot <- levelplot(rat, att='ID',
              maxpixels=ncell(rat),
              col.regions=df$Color,
              par.settings = list(axis.line = list(col = "transparent"), 
                                  strip.background = list(col = 'transparent'), 
                                  strip.border = list(col = 'transparent')), 
              scales = list(col = "transparent"),
              main=paste0("Watauga County land cover ", years.list[[i]]),
              colorkey=FALSE)
    print(plot)
  }
}, interval=1, movie.name="lc_time_series.gif", ani.width=1200, ani.height=900)})
```

##### 2011 {.unnumbered}

```{r lc_2011, echo=FALSE, message=FALSE, warning=FALSE}



rat <- ratify(lc_2011)

myKey <- list(
  rectangles = list(col = df$Color),
  text = list(lab = df$Class),
  space = 'right',
  columns = 1,
  size = 2,
  cex = .6
)
levelplot(rat, att='ID', 
          col.regions=df$Color,
          maxpixels=ncell(rat), # Try setting maxpixels to the number of cells in the raster
          par.settings = list(
            axis.line = list(col = "transparent"), 
            strip.background = list(col = 'transparent'), 
            strip.border = list(col = 'transparent')
          ), 
          scales = list(col = "transparent"),
          colorkey = FALSE,
          key = myKey,
          main = "Watauga 2011 Land Cover") # Title added here
```


##### 2013 {.unnumbered}
```{r lc_2013, echo=FALSE, message=FALSE, warning=FALSE}
rat2 <- ratify(lc_2013)

levelplot(rat2, att='ID', 
          col.regions=df$Color,
          maxpixels=ncell(rat2), # Try setting maxpixels to the number of cells in the raster
          par.settings = list(
            axis.line = list(col = "transparent"), 
            strip.background = list(col = 'transparent'), 
            strip.border = list(col = 'transparent')
          ), 
          scales = list(col = "transparent"),
          colorkey = FALSE,
          key = myKey,
          main = "Watauga 2013 Land Cover") # Title added here
```

##### 2016 {.unnumbered}
```{r lc_2016, echo=FALSE, message=FALSE, warning=FALSE}
rat3 <- ratify(lc_2016)

levelplot(rat3, att='ID', 
          col.regions=df$Color,
          maxpixels=ncell(rat3), # Try setting maxpixels to the number of cells in the raster
          par.settings = list(
            axis.line = list(col = "transparent"), 
            strip.background = list(col = 'transparent'), 
            strip.border = list(col = 'transparent')
          ), 
          scales = list(col = "transparent"),
          colorkey = FALSE,
          key = myKey,
          main = "Watauga 2016 Land Cover") # Title added here
```

##### 2019 {.unnumbered}
```{r lc_2019, echo=FALSE, message=FALSE, warning=FALSE}
rat4 <- ratify(lc_2019)

levelplot(rat4, att='ID', 
          col.regions=df$Color,
          maxpixels=ncell(rat4), # Try setting maxpixels to the number of cells in the raster
          par.settings = list(
            axis.line = list(col = "transparent"), 
            strip.background = list(col = 'transparent'), 
            strip.border = list(col = 'transparent')
          ), 
          scales = list(col = "transparent"),
          colorkey = FALSE,
          key = myKey,
          main = "Watauga 2019 Land Cover") # Title added here
```

##### 2021 {.unnumbered}

```{r lc_2021_2, echo=FALSE, message=FALSE, warning=FALSE}
vals <-unique(s[[5]])  # Get unique values from lc_2021
df <- legend[legend$ID %in% vals,]  # Filter legend information based on lc_2021 values
rat5 <- ratify(lc_2021)

levelplot(rat5, att='ID', 
          col.regions=df$Color,
          maxpixels=ncell(rat5), # Try setting maxpixels to the number of cells in the raster
          par.settings = list(
            axis.line = list(col = "transparent"), 
            strip.background = list(col = 'transparent'), 
            strip.border = list(col = 'transparent')
          ), 
          scales = list(col = "transparent"),
          colorkey = FALSE,
          key = myKey,
          main = "Watauga 2021 Land Cover") # Title added here

```


###### udpate ends here




```{r}

years.list <- list("2011", "2013", "2016", "2019", "2021")


saveGIF({
  for(i in 1:nlayers(s)){
    rat <- ratify(s[[i]])
    plot <- levelplot(rat, att='ID',
              maxpixels=ncell(rat),
              col.regions=df$Color,
              par.settings = list(axis.line = list(col = "transparent"), 
                                  strip.background = list(col = 'transparent'), 
                                  strip.border = list(col = 'transparent')), 
              scales = list(col = "transparent"),
              main=paste0("Watauga County land cover ", years.list[[i]]),
              colorkey=FALSE)
    print(plot)
  }
}, interval=1, movie.name="lc_time_series.gif", ani.width=1200, ani.height=900)




```



```{r}

years<-c(2011, 2013, 2016, 2019, 2021)

d<-df
for (i in 1:length(years)) {
  d<-merge(d, freq(s[[i]]), by.x="ID" ,by.y="value", all.y=F, all.x=T)
  names(d)[ncol(d)]<-paste0("pix_", years[[i]])
  }


d$square.mile.change<-(d$pix_2021 - d$pix_2011) * 30 * 30 * 0.00000038610
d$percentchange<-(d$pix_2021 - d$pix_2011)/d$pix_2011
d$prop2021<-d$pix_2021/sum(d$pix_2021)

d$percentchange.2011.2021<-paste(round(100*d$percentchange, 2), "%", sep="")
d$percent.area.2021<-paste(round(100*d$prop2021, 2), "%", sep="")




kable(d[,c(2,10,13,14)])  %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = F)



```


## Final Code for landcover percentages per parcel
```{r}

parcels <- parcels
landcover_2016 <- lc_2016


# Transform CRS of parcels to match the landcover raster if they are different
if (st_crs(parcels) != crs(landcover_2016)) {
  parcels <- st_transform(parcels, crs = crs(landcover_2016))
}

# Perform the exact extraction
coverage <- exact_extract(landcover_2016, parcels, include_cols = c("GlobalID"))

# Function to calculate and round percentages
calculate_percentages <- function(df) {
  total_area <- sum(df$coverage_fraction)
  percentages <- 100 * df$coverage_fraction / total_area
  percentages_rounded <- round(percentages, 2)  # Round percentages to 2 decimal places
  return(percentages_rounded)
}

# Apply calculate_percentages and bind results to a new data frame
parcel_percentages <- do.call(rbind, lapply(coverage, function(x) {
  percentages <- calculate_percentages(x)
  x$percentage <- percentages  # Assign rounded percentages
  return(x)
}))

# Spread the data to wide format and summarize
parcel_percentages_wide <- parcel_percentages %>%
  group_by(GlobalID, value) %>%
  summarize(percentage = sum(percentage, na.rm = TRUE), .groups = 'drop') %>%
  pivot_wider(names_from = value, values_from = percentage, names_prefix = "Landcover_")

# Merge with original parcels data to include geospatial information
final_dataset <- parcels %>%
  left_join(parcel_percentages_wide, by = "GlobalID")

# Select the desired columns and turn NA's to 0 for landcover columns
parcel_lc_2016 <- final_dataset %>%
  select(GlobalID, starts_with("Landcover_"), geometry) %>%
  mutate(across(starts_with("Landcover_"), ~replace_na(round(., 2), 0)))  # Ensure rounding here just in case and replace NA with 0

# Define a mapping between landcover codes and descriptions
landcover_mapping <- c("Landcover_11" = "Open Water",
                       "Landcover_12" = "Perennial Ice/Snow",
                       "Landcover_21" = "Developed, Open Space",
                       "Landcover_22" = "Developed, Low Intensity",
                       "Landcover_23" = "Developed, Medium Intensity",
                       "Landcover_24" = "Developed High Intensity",
                       "Landcover_31" = "Barren Land (Rock/Sand/Clay)",
                       "Landcover_41" = "Deciduous Forest",
                       "Landcover_42" = "Evergreen Forest",
                       "Landcover_43" = "Mixed Forest",
                       "Landcover_51" = "Dwarf Scrub",
                       "Landcover_52" = "Shrub/Scrub",
                       "Landcover_71" = "Grassland/Herbaceous",
                       "Landcover_72" = "Sedge/Herbaceous",
                       "Landcover_73" = "Lichens",
                       "v74" = "Moss",
                       "Landcover_81" = "Pasture/Hay",
                       "Landcover_82" = "Cultivated Crops",
                       "Landcover_90" = "Woody Wetlands",
                       "Landcover_95" = "Emergent Herbaceous Wetlands")

parcel_lc_2016 <- parcel_lc_2016 %>%
  rename("Open Water" = "Landcover_11",
  "Developed, Open Space" = "Landcover_21",
  "Developed, Low Intensity" = "Landcover_22",
  "Developed, Medium Intensity" = "Landcover_23",
  "Developed High Intensity" = "Landcover_24",
  "Barren Land (Rock/Sand/Clay)" = "Landcover_31",
  "Deciduous Forest" = "Landcover_41",
  "Evergreen Forest" = "Landcover_42",
  "Mixed Forest" = "Landcover_43",
  "Shrub/Scrub" = "Landcover_52",
  "Grassland/Herbaceous" = "Landcover_71",
  "Pasture/Hay" = "Landcover_81",
  "Cultivated Crops" = "Landcover_82",
  "Woody Wetlands" = "Landcover_90",
  "Emergent Herbaceous Wetlands" = "Landcover_95"
)

# View the final dataset
View(parcel_lc_2016)

write.csv(parcel_lc_2016, "parcel_landcover_percentages_2016.csv", row.names = FALSE)

```

```{r}

parcels <- parcels
landcover_2021 <- lc_2021


# Transform CRS of parcels to match the landcover raster if they are different
if (st_crs(parcels) != crs(landcover_2021)) {
  parcels <- st_transform(parcels, crs = crs(landcover_2021))
}

# Perform the exact extraction
coverage <- exact_extract(landcover_2021, parcels, include_cols = c("GlobalID"))

# Function to calculate and round percentages
calculate_percentages <- function(df) {
  total_area <- sum(df$coverage_fraction)
  percentages <- 100 * df$coverage_fraction / total_area
  percentages_rounded <- round(percentages, 2)  # Round percentages to 2 decimal places
  return(percentages_rounded)
}

# Apply calculate_percentages and bind results to a new data frame
parcel_percentages <- do.call(rbind, lapply(coverage, function(x) {
  percentages <- calculate_percentages(x)
  x$percentage <- percentages  # Assign rounded percentages
  return(x)
}))

# Spread the data to wide format and summarize
parcel_percentages_wide <- parcel_percentages %>%
  group_by(GlobalID, value) %>%
  summarize(percentage = sum(percentage, na.rm = TRUE), .groups = 'drop') %>%
  pivot_wider(names_from = value, values_from = percentage, names_prefix = "Landcover_")

# Merge with original parcels data to include geospatial information
final_dataset <- parcels %>%
  left_join(parcel_percentages_wide, by = "GlobalID")

# Select the desired columns and turn NA's to 0 for landcover columns
parcel_lc_2021 <- final_dataset %>%
  select(GlobalID, starts_with("Landcover_"), geometry) %>%
  mutate(across(starts_with("Landcover_"), ~replace_na(round(., 2), 0)))  # Ensure rounding here just in case and replace NA with 0


parcel_lc_2021 <- parcel_lc_2021 %>%
  rename("Open Water" = "Landcover_11",
  "Developed, Open Space" = "Landcover_21",
  "Developed, Low Intensity" = "Landcover_22",
  "Developed, Medium Intensity" = "Landcover_23",
  "Developed High Intensity" = "Landcover_24",
  "Barren Land (Rock/Sand/Clay)" = "Landcover_31",
  "Deciduous Forest" = "Landcover_41",
  "Evergreen Forest" = "Landcover_42",
  "Mixed Forest" = "Landcover_43",
  "Shrub/Scrub" = "Landcover_52",
  "Grassland/Herbaceous" = "Landcover_71",
  "Pasture/Hay" = "Landcover_81",
  "Cultivated Crops" = "Landcover_82",
  "Woody Wetlands" = "Landcover_90",
  "Emergent Herbaceous Wetlands" = "Landcover_95"
)

# View the final dataset
View(parcel_lc_2021)

write.csv(parcel_lc_2021, "parcel_landcover_percentages_2021.csv", row.names = FALSE)

```
